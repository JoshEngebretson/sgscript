
include "sockets";

function ee(){ return "(errno: " $ errno(true) $ ")"; }

S = socket( PF_INET, SOCK_STREAM, IPPROTO_TCP );
if( !S )
	sys_print( SGS_ERROR, "Failed to create socket " $ ee() );

if( !S.bind_port( 8080 ) || !S.listen( 10 ) )
	sys_print( SGS_ERROR, "Failed to configure socket " $ ee() );

for(;;)
{
	C = S.accept();
	println( "Request! Let's send something..." );
	C.send( "This is a test." );
	C.shutdown( SHUT_WR );
	C.close();
	C = null;
}
