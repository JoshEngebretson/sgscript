
global called = {};

obj = {a=1,b=2};
objcp = {a=1,b=2};
obj2 = {a=10,b=20};
global iface =
{
	__typeof = function(){ called.typeof = this; return "typeIFACE"; },
	__clone = function(){ called.clone = this; return "cloneTest"; },
	__tobool = function(){ called.tobool = this; return true; },
	__toint = function(){ called.toint = this; return 8765; },
	__toreal = function(){ called.toreal = this; return 3.14159; },
	__tostring = function(){ called.tostring = this; return "IFACE"; },
	__toptr = function(){ called.toptr = this; return toptr(12345); },
	__negate = function(){ called.negate = this; return -123456; },
	__add = function(a,b){ called.add = this; return class({a=a.a+b.a,b=a.b+b.b},iface); },
	__sub = function(a,b){ called.sub = this; return class({a=a.a-b.a,b=a.b-b.b},iface); },
	__mul = function(a,b){ called.mul = this; return class({a=a.a*b.a,b=a.b*b.b},iface); },
	__div = function(a,b){ called.div = this; return class({a=a.a/b.a,b=a.b/b.b},iface); },
	__mod = function(a,b){ called.mod = this; return class({a=a.a%b.a,b=a.b%b.b},iface); },
	__compare = function(a,b){ called.compare = this; return a.a <=> b.a || a.b <=> b.b; },
	__call = function(a,b){ called.call = this; return a,b; },
};
class( obj, iface );
class( obj2, iface );
class( objcp, iface );
cntnr = { me = obj };

testEqual( metaobj_get(obj), iface, "metaobj - is set?" );

testEqual( typeof(obj), "typeIFACE", "metamethod - typeof - result" );
testEqual( @called.typeof, obj, "metamethod - typeof - correctly called" );

testEqual( clone(obj), "cloneTest", "metamethod - clone - result" );
testEqual( @called.clone, obj, "metamethod - clone - correctly called" );

testEqual( tobool(obj), true, "metamethod - tobool - result" );
testEqual( @called.tobool, obj, "metamethod - tobool - correctly called" );

testEqual( toint(obj), 8765, "metamethod - toint - result" );
testEqual( @called.toint, obj, "metamethod - toint - correctly called" );

testEqual( toreal(obj), 3.14159, "metamethod - toreal - result" );
testEqual( @called.toreal, obj, "metamethod - toreal - correctly called" );

testEqual( tostring(obj), "IFACE", "metamethod - tostring - result" );
testEqual( @called.tostring, obj, "metamethod - tostring - correctly called" );

testEqual( toptr(obj), toptr(12345), "metamethod - toptr - result" );
testEqual( @called.toptr, obj, "metamethod - toptr - correctly called" );

testEqual( -obj, -123456, "metamethod - negate - result" );
testEqual( @called.negate, obj, "metamethod - negate - correctly called" );

testEqual( (obj+obj2).a, 11, "metamethod - add - result" );
testEqual( @called.add, obj, "metamethod - add - correctly called" );

testEqual( (obj-obj2).a, -9, "metamethod - sub - result" );
testEqual( @called.sub, obj, "metamethod - sub - correctly called" );

testEqual( (obj*obj2).a, 10, "metamethod - mul - result" );
testEqual( @called.mul, obj, "metamethod - mul - correctly called" );

testEqual( (obj/obj2).a, 0.1, "metamethod - div - result" );
testEqual( @called.div, obj, "metamethod - div - correctly called" );

testEqual( (obj%obj2).a, 1, "metamethod - mod - result" );
testEqual( @called.mod, obj, "metamethod - mod - correctly called" );

testEqual( obj==objcp, true, "metamethod - compare - result" );
testEqual( @called.compare, obj, "metamethod - compare - correctly called" );

testEqual( obj(5), 5, "metamethod - call/1 - result" );
testEqual( @called.call, obj, "metamethod - call/1 - correctly called" );

testEqual( cntnr.me(5), 5, "metamethod - call/2 - result" );
testEqual( @called.call, cntnr, "metamethod - call/2 - correctly called" );
